(function(e){"use strict";function t(e,t,r,n,a){var c=new XMLHttpRequest;c.onreadystatechange=function(){4===this.readyState&&n.call(a||this,this.responseText,this)},c.open(t,e,!0),c.setRequestHeader("Cache-Control","no-cache"),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),"POST"===t?(r instanceof FormData||c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.send(r)):c.send()}function r(e,t,r){var a=n.createElement("DIV");a.className="comment-alert alert-"+e,a.innerText=t;var c=r.querySelectorAll(".comment-alert");c.length>0&&Array.prototype.forEach.call(c,function(e){e.parentElement.removeChild(e)}),r.children.length>0?r.insertBefore(a,r.children[0]):r.appendChild(a)}var n=e.document;n.addEventListener("DOMContentLoaded",function(){var e=n.querySelector("form.comment-form"),a=n.querySelector(".post-comments-list"),c=n.querySelector("a[data-captcha='reload']");e&&e.addEventListener("submit",function(i){if(i.preventDefault(),"function"!=typeof FormData||!COMMENTS_AJAX)return!0;var o=new FormData(this),l=this,s=this.querySelector("[name='comments']");if(s.disabled)return!0;i.preventDefault(),s.disabled=!0,s.classList.add("loading"),o.append("comments",s.value),t(PC_PATH,"POST",o,function(t){var i=JSON.parse(t);if(a&&"success"===i.status&&"comment"in i){var o=e.querySelector("input[name='comment[parent_uid]']");if(o&&o.value){var u=document.getElementById("comment-"+o.value);u?u.insertAdjacentHTML("afterend",i.comment):a.insertAdjacentHTML("afterbegin",i.comment)}else a.querySelector(".comment")?a.querySelector(".comment").insertAdjacentHTML("beforebegin",i.comment):a.insertAdjacentHTML("afterbegin",i.comment);a.querySelector(".comment").classList.add("new-comment"),a.querySelector(".comment").scrollIntoView({behavior:"smooth",block:"center"});for(var m=l.querySelectorAll("#comment-title,#comment-text"),d=0,p=m.length;d<p;d++)"SELECT"===m[d].tagName?m[d].options[0].selected=!0:"checkbox"===m[d].getAttribute("type")?m[d].checked=!1:m[d].value="";r("success",i.success,e.querySelector(".comment-article"))}else"error"===i.status&&(r("error",i.error,e.querySelector(".comment-article")),c&&"captcha"in i&&(n.querySelector("input[name='comment[captcha]']").value="",c.querySelector("img").src=i.captcha));s.disabled=!1,s.classList.remove("loading")})}),c&&c.addEventListener("click",function(e){if(!COMMENTS_AJAX)return!1;e.preventDefault(),c.classList.add("reload");var r="action=comments&comments=captcha&tokenCSRF="+a,a=n.querySelector("input[name='tokenCSRF']").value;t(PC_PATH,"POST",r+a,function(e){var t=JSON.parse(e);"success"!==t.status&&window.location.replace(c.getAttribute("href")),c.querySelector("img").src=t.captcha,c.classList.remove("reload")})}),a&&a.addEventListener("click",function(t){if("A"!=t.target.tagName||!e)return!0;var r=t.target.getAttribute("href");if(r.indexOf("comments=reply")<0)return!0;t.preventDefault();var a=function e(t){var r=t.parentElement;return r.classList.contains("comment")?r:e(r)}(t.target),c=n.createElement("DIV");c.className="comment-reply",c.innerHTML='<a href="'+window.location.href+'" class="reply-cancel"></a><div class="reply-title">'+a.querySelector(".author-username").innerText+' wrote:</div><div class="reply-content">'+a.querySelector(".comment-comment").innerHTML+"</div>";var i=n.createElement("INPUT");i.type="hidden",i.name="comment[parent_uid]",i.value=a.id.replace("comment-",""),c.querySelector(".reply-cancel").addEventListener("click",function(t){t.preventDefault(),c.parentElement.removeChild(c),i.parentElement.removeChild(i);var r=e.querySelector("button").innerText;e.querySelector("button").value="comment",e.querySelector("button").innerText=e.querySelector("button").getAttribute("data-string"),e.querySelector("button").setAttribute("data-string",r)});var o=e.querySelector(".comment-article");o.querySelector(".comment-reply")?o.replaceChild(c,o.querySelector(".comment-reply")):o.insertBefore(c,e.querySelector("textarea").parentElement);var l=e.querySelector(".comment-footer");l.querySelector("input[name='comment[parent_uid]']")?l.replaceChild(i,l.querySelector("input[name='comment[parent_uid]']")):l.appendChild(i);var s=e.querySelector("button").innerText;e.querySelector("button").value="reply",e.querySelector("button").innerText=e.querySelector("button").getAttribute("data-string"),e.querySelector("button").setAttribute("data-string",s)}),a&&a.addEventListener("click",function(e){if("A"!=e.target.tagName||!COMMENTS_AJAX)return!0;if(e.target.classList.contains("disabled"))return!0;var r=e.target.getAttribute("href");if(r.indexOf("&type=like")<0&&r.indexOf("&type=dislike")<0)return!0;e.preventDefault(),e.target.classList.add("disabled");var n=function e(t){var r=t.parentElement;return r.classList.contains("comment")?r:e(r)}(e.target),a=e.target;r=r.split("?"),t(PC_PATH,"POST",r[1],function(e){var t=JSON.parse(e);if("success"===t.status&&"rating"in t){var r=n.querySelector("[data-comments='like']");r&&(r.innerText=String(t.rating[0])),r.parentElement.classList[r.parentElement===a?"add":"remove"]("active");var c=n.querySelector("[data-comments='dislike']");c&&(c.innerText=String(t.rating[1])),c.parentElement.classList[c.parentElement===a?"add":"remove"]("active")}a.classList.remove("disabled")})})})})(window);